<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LOLA | Inbox</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      ::-webkit-scrollbar {
        width: 6px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }

      /* WhatsApp Specific Styles for the Center Area */
      .wa-bg {
        background-color: #efeae2;
        background-image: url("https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png");
        background-repeat: repeat;
        background-size: 400px;
      }
      .wa-message-sent {
        background-color: #d9fdd3; /* WhatsApp Green Bubble */
        box-shadow: 0 1px 0.5px rgba(0, 0, 0, 0.13);
      }
      .wa-message-received {
        background-color: #ffffff;
        box-shadow: 0 1px 0.5px rgba(0, 0, 0, 0.13);
      }
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
    </style>
  </head>
  <body class="bg-white h-screen flex flex-col overflow-hidden">
    <!-- ================= HEADER (Maintained from Code 1) ================= -->
    <header
      class="h-16 border-b border-slate-200 flex items-center justify-between px-6 bg-white z-20 shrink-0 shadow-sm"
    >
      <div class="flex items-center gap-6">
        <a
          href="dashboard.html"
          class="text-2xl font-bold tracking-tight text-slate-900"
          >LOLA<span class="text-emerald-500">.</span></a
        >
        <div class="h-6 w-px bg-slate-200"></div>
        <h2 class="font-semibold text-slate-700">Unified Inbox</h2>
      </div>
      <div
        class="flex items-center gap-3 bg-emerald-50 px-3 py-1.5 rounded-full border border-emerald-100"
      >
        <span class="relative flex h-2.5 w-2.5">
          <span
            class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"
          ></span>
          <span
            class="relative inline-flex rounded-full h-2.5 w-2.5 bg-emerald-500"
          ></span>
        </span>
        <span class="text-xs font-medium text-emerald-700">System Online</span>
      </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
      <!-- ================= LEFT SIDEBAR (Maintained from Code 1) ================= -->
      <aside
        class="w-80 border-r border-slate-200 flex flex-col bg-slate-50/50"
      >
        <div class="p-4 border-b border-slate-200 bg-white">
          <div class="relative">
            <svg
              class="absolute left-3 top-2.5 w-4 h-4 text-slate-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              ></path>
            </svg>
            <input
              type="text"
              placeholder="Search contact, phone or SN..."
              class="w-full pl-9 pr-4 py-2 bg-slate-100 border-transparent rounded-lg text-sm focus:bg-white focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition outline-none"
            />
          </div>
        </div>

        <div class="overflow-y-auto flex-1">
          <!-- Active Chat -->
          <div
            class="p-4 bg-white border-l-4 border-l-emerald-500 border-b border-slate-100 shadow-sm cursor-pointer"
          >
            <div class="flex justify-between items-start mb-1">
              <span class="font-bold text-slate-900 text-sm">John Doe</span>
              <span
                class="text-[10px] text-emerald-600 font-bold bg-emerald-50 px-1.5 py-0.5 rounded"
                >NOW</span
              >
            </div>
            <p class="text-sm text-slate-800 font-medium truncate">
              Yes, come pick it up tomorrow.
            </p>
            <p class="text-xs text-slate-400 mt-1">SN-12938 ‚Ä¢ Lagos</p>
          </div>
          <!-- Other Chats... -->
          <div
            class="p-4 hover:bg-white border-b border-slate-100 cursor-pointer transition-colors group"
          >
            <div class="flex justify-between items-start mb-1">
              <span
                class="font-semibold text-slate-700 text-sm group-hover:text-slate-900"
                >Mary Smith</span
              >
              <span class="text-[10px] text-slate-400">2h ago</span>
            </div>
            <p
              class="text-sm text-slate-500 truncate group-hover:text-slate-600"
            >
              Is the 5000 naira real?
            </p>
          </div>
        </div>
      </aside>

      <!-- ================= CENTER: CHAT AREA (Redesigned to WhatsApp Style) ================= -->
      <main class="flex-1 flex flex-col relative wa-bg">
        <!-- Messages Container -->
        <div
          id="messagesContainer"
          class="flex-1 overflow-y-auto p-4 md:p-8 space-y-4 relative z-10 scroll-smooth"
        >
          <!-- Encryption Label -->
          <div class="flex justify-center mb-6">
            <div
              class="bg-[#ffeecd] text-[#54656f] text-[10px] px-3 py-1.5 rounded-lg shadow-sm text-center max-w-sm flex items-center justify-center gap-2 select-none"
            >
              <span class="text-xs">üîí</span> Messages are end-to-end encrypted.
            </div>
          </div>

          <div class="flex justify-center">
            <span
              class="text-xs uppercase text-slate-500 font-medium bg-white/80 px-3 py-1 rounded shadow-sm"
              >Today</span
            >
          </div>

          <!-- Bot Message (Left - White Bubble) -->
          <div class="flex justify-start group">
            <div class="max-w-md">
              <div
                class="wa-message-received p-3 px-4 rounded-lg rounded-tl-none text-sm text-[#111b21]"
              >
                <p class="leading-relaxed">
                  Hi <strong>John</strong>, LOLA is offering
                  <strong>‚Ç¶5,000</strong> if you return terminal
                  <strong>SN-1234</strong>. Reply '1' to arrange pickup.
                </p>
                <div class="text-[10px] text-slate-400 text-right mt-1">
                  9:00 AM
                </div>
              </div>
            </div>
          </div>

          <!-- User Reply (Right - Green Bubble) -->
          <div class="flex justify-end group">
            <div class="max-w-md">
              <div
                class="wa-message-sent p-3 px-4 rounded-lg rounded-tr-none text-sm text-[#111b21]"
              >
                <p class="leading-relaxed">
                  Yes, come pick it up tomorrow. Where do I drop it?
                </p>
                <div
                  class="text-[10px] text-slate-500 text-right mt-1 flex justify-end gap-1 items-center"
                >
                  <span>9:45 AM</span>
                  <svg
                    class="w-3 h-3 text-[#53bdeb]"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M5 13l4 4L19 7"
                    ></path>
                  </svg>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- WhatsApp Style Composer -->
        <div class="p-3 bg-[#f0f2f5] border-t border-slate-200 z-20 relative">
          <!-- Quick Chips -->
          <div class="flex gap-2 mb-2 overflow-x-auto no-scrollbar px-2">
            <button
              class="quick-reply flex-shrink-0 text-xs bg-white border border-slate-200 hover:bg-slate-50 text-slate-600 px-3 py-1.5 rounded-full transition cursor-pointer shadow-sm"
            >
              Verify Address
            </button>
            <button
              class="quick-reply flex-shrink-0 text-xs bg-white border border-slate-200 hover:bg-slate-50 text-slate-600 px-3 py-1.5 rounded-full transition cursor-pointer shadow-sm"
            >
              Payment Info
            </button>
          </div>

          <div class="flex items-end gap-2">
            <input id="fileInput" type="file" class="hidden" multiple />

            <button
              id="attachBtn"
              type="button"
              class="p-2 text-slate-500 hover:text-slate-600 mb-1"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"
                ></path>
              </svg>
            </button>

            <button
              id="emojiBtn"
              aria-label="Open emoji picker"
              class="p-2 text-slate-500 hover:text-slate-600 mb-1"
              type="button"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                ></path>
              </svg>
            </button>
            <input id="fileInput" type="file" class="hidden" multiple />

            <!-- Input Field (with attachment chips inside) -->
            <div
              class="flex-1 bg-white rounded-lg px-3 py-2 shadow-sm flex items-center mb-1"
            >
              <div
                id="selectedFiles"
                class="flex gap-2 items-center overflow-x-auto"
              ></div>
              <input
                type="text"
                id="msgInput"
                placeholder="Type a message..."
                class="flex-1 bg-transparent outline-none text-sm text-[#111b21] py-1"
                autocomplete="off"
              />
            </div>

            <!-- Emoji picker will be injected here -->
            <div
              id="emojiPicker"
              class="hidden absolute bottom-20 left-4 bg-white border border-slate-200 rounded-lg p-2 shadow-lg w-64 max-h-40 overflow-auto z-50"
            >
              <div class="grid grid-cols-6 gap-2 text-lg">
                <!-- fallback emojis; JS will delegate clicks -->
                <button type="button" class="emojiBtn">üòÄ</button>
                <button type="button" class="emojiBtn">üòÅ</button>
                <button type="button" class="emojiBtn">üòÇ</button>
                <button type="button" class="emojiBtn">üòä</button>
                <button type="button" class="emojiBtn">üòç</button>
                <button type="button" class="emojiBtn">üëç</button>
                <button type="button" class="emojiBtn">üôè</button>
                <button type="button" class="emojiBtn">üéâ</button>
                <button type="button" class="emojiBtn">üî•</button>
                <button type="button" class="emojiBtn">üò¢</button>
                <button type="button" class="emojiBtn">üòÆ</button>
                <button type="button" class="emojiBtn">üòâ</button>
              </div>
            </div>

            <!-- Send Button -->
            <button
              id="sendBtn"
              class="p-3 bg-[#00a884] hover:bg-[#008f6f] text-white rounded-full shadow-md transition transform active:scale-95 flex items-center justify-center mb-1"
            >
              <svg
                class="w-5 h-5 ml-0.5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"
                ></path>
              </svg>
            </button>
          </div>
          <p class="text-center text-[10px] text-slate-400 mt-1">
            Redirects to WhatsApp: 08129136028
          </p>
        </div>
      </main>

      <!-- ================= RIGHT SIDEBAR (Maintained from Code 1) ================= -->
      <aside
        class="w-72 bg-white border-l border-slate-200 p-6 hidden xl:block overflow-y-auto"
      >
        <div class="text-center mb-8 pb-8 border-b border-slate-100">
          <div
            class="w-20 h-20 bg-gradient-to-br from-slate-100 to-slate-200 rounded-full mx-auto flex items-center justify-center text-3xl mb-4 border-4 border-white shadow-lg"
          >
            üë§
          </div>
          <h3 class="font-bold text-slate-900 text-lg">John Doe</h3>
          <p
            class="text-sm text-slate-500 font-mono mt-1 bg-slate-100 inline-block px-2 py-0.5 rounded"
          >
            +234 812 913 6028
          </p>
        </div>

        <div class="space-y-6">
          <!-- Info Card -->
          <div
            class="bg-slate-50 rounded-xl p-5 border border-slate-100 shadow-sm"
          >
            <div class="flex items-center justify-between mb-4">
              <h4 class="text-xs font-bold text-slate-400 uppercase">
                Terminal Info
              </h4>
              <span class="w-2 h-2 rounded-full bg-red-500"></span>
            </div>
            <div class="space-y-3 text-sm">
              <div class="flex justify-between">
                <span class="text-slate-500">ID:</span>
                <span class="font-mono text-slate-900 font-semibold"
                  >SN-12345</span
                >
              </div>
              <div class="flex justify-between">
                <span class="text-slate-500">Status:</span>
                <span
                  class="text-red-600 bg-red-50 px-2 py-0.5 rounded text-xs font-bold"
                  >Inactive</span
                >
              </div>
            </div>
          </div>

          <!-- Actions -->
          <div>
            <h4 class="text-xs font-bold text-slate-400 uppercase mb-3">
              Next Steps
            </h4>
            <div class="space-y-3">
              <button
                onclick="alert('Pickup Scheduled for tomorrow!')"
                class="w-full bg-emerald-600 text-white py-3 rounded-xl text-sm font-bold hover:bg-emerald-700 shadow-lg shadow-emerald-500/20 transition transform active:scale-95 flex items-center justify-center gap-2"
              >
                <svg
                  class="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                  ></path>
                </svg>
                Schedule Pickup
              </button>
              <button
                onclick="alert('Terminal Verified!')"
                class="w-full bg-white border border-slate-200 text-slate-700 py-3 rounded-xl text-sm font-semibold hover:bg-slate-50 transition flex items-center justify-center gap-2"
              >
                <svg
                  class="w-4 h-4 text-emerald-500"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                  ></path>
                </svg>
                Mark Verified
              </button>
              <button
                onclick="alert('Marked as Refused.')"
                class="w-full bg-white border border-red-100 text-red-500 py-3 rounded-xl text-sm font-semibold hover:bg-red-50 transition flex items-center justify-center gap-2"
              >
                <svg
                  class="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"
                  ></path>
                </svg>
                Mark Refused
              </button>
            </div>
          </div>
        </div>
      </aside>
    </div>

    <!-- JavaScript Functionality -->
    <script>
      const msgInput = document.getElementById("msgInput");
      const sendBtn = document.getElementById("sendBtn");
      const messagesContainer = document.getElementById("messagesContainer");
      const quickReplies = document.querySelectorAll(".quick-reply");

      // Constants
      // 234 is Nigeria's country code. Removed leading '0' from 081...
      const WHATSAPP_NUMBER = "2348129136028";

      // Function to handle sending
      function handleSend() {
        const text = msgInput.value.trim();
        if (!text) return;

        // 1. Visually add the message to the chat (User Experience)
        const now = new Date();
        const timeString = now.toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit",
        });

        const wrapper = document.createElement("div");
        wrapper.className = "flex justify-end group animate-pulse";

        wrapper.innerHTML = `
          <div class="max-w-md">
            <div class="wa-message-sent p-3 px-4 rounded-lg rounded-tr-none text-sm text-[#111b21]">
              <p class="leading-relaxed">${escapeHtml(text)}</p>
              <div class="text-[10px] text-slate-500 text-right mt-1 flex justify-end gap-1 items-center">
                <span>${timeString}</span>
                <svg class="w-3 h-3 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
              </div>
            </div>
          </div>
        `;

        messagesContainer.appendChild(wrapper);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
        msgInput.value = "";

        // 2. Redirect to WhatsApp
        setTimeout(() => {
          const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(
            text
          )}`;
          window.open(url, "_blank");
          wrapper.classList.remove("animate-pulse"); // Remove visual waiting effect
        }, 500);
      }

      function escapeHtml(unsafe) {
        return unsafe
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/\"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }

      // Event Listeners
      sendBtn.addEventListener("click", sendWithAttachments);

      msgInput.addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
          e.preventDefault();
          sendWithAttachments();
        }
      });

      // Quick Reply Logic
      quickReplies.forEach((btn) => {
        btn.addEventListener("click", function () {
          const replyText = this.innerText.toLowerCase();
          msgInput.value = "Please confirm your " + replyText + ".";
          msgInput.focus();
        });
      });

      // Emoji picker logic
      const emojiBtn = document.getElementById("emojiBtn");
      const emojiPicker = document.getElementById("emojiPicker");

      function insertAtCursor(input, text) {
        const start = input.selectionStart || 0;
        const end = input.selectionEnd || 0;
        const value = input.value || "";
        input.value = value.slice(0, start) + text + value.slice(end);
        const pos = start + text.length;
        input.selectionStart = input.selectionEnd = pos;
        input.focus();
      }

      // Delegate clicks on emoji buttons
      document.addEventListener("click", function (e) {
        if (
          e.target &&
          e.target.classList &&
          e.target.classList.contains("emojiBtn")
        ) {
          e.preventDefault();
          insertAtCursor(
            msgInput,
            e.target.textContent || e.target.innerText || ""
          );
          // keep picker open for quick multiple inserts
        }
      });

      function toggleEmojiPicker(show) {
        if (!emojiPicker || !emojiBtn) return;
        const isHidden = emojiPicker.classList.contains("hidden");
        const shouldShow = typeof show === "boolean" ? show : isHidden;
        emojiPicker.classList.toggle("hidden", !shouldShow);
        emojiBtn.setAttribute("aria-expanded", shouldShow ? "true" : "false");
      }

      if (emojiBtn) {
        emojiBtn.addEventListener("click", function (e) {
          e.stopPropagation();
          toggleEmojiPicker();
        });
      }

      // Close picker on outside click or Escape
      document.addEventListener("click", function (e) {
        if (!emojiPicker) return;
        if (
          !emojiPicker.classList.contains("hidden") &&
          !emojiPicker.contains(e.target) &&
          e.target !== emojiBtn
        ) {
          toggleEmojiPicker(false);
        }
      });
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") toggleEmojiPicker(false);
      });

      // --- Attachment handlers & sendWithAttachments ---
      const attachBtnEl = document.getElementById("attachBtn");
      const fileInputEl = document.getElementById("fileInput");
      const selectedFilesEl = document.getElementById("selectedFiles");
      let attachedFiles = [];

      function renderSelectedFiles() {
        if (!selectedFilesEl) return;
        selectedFilesEl.innerHTML = "";
        attachedFiles.forEach((file, idx) => {
          const chip = document.createElement("div");
          chip.className =
            "flex items-center gap-2 bg-slate-100 px-2 py-1 rounded-full text-sm text-slate-700 border border-slate-200";
          chip.style.maxWidth = "12rem";
          chip.innerHTML = `<span class="truncate block">${escapeHtml(
            file.name
          )}</span><button type=\"button\" data-idx=\"${idx}\" class=\"ml-1 text-slate-400 hover:text-slate-600\">‚úï</button>`;
          chip.querySelector("button").addEventListener("click", (e) => {
            const i = Number(e.currentTarget.getAttribute("data-idx"));
            attachedFiles.splice(i, 1);
            const dt = new DataTransfer();
            attachedFiles.forEach((f) => dt.items.add(f));
            if (fileInputEl) fileInputEl.files = dt.files;
            renderSelectedFiles();
          });
          selectedFilesEl.appendChild(chip);
        });
      }

      if (attachBtnEl && fileInputEl) {
        attachBtnEl.addEventListener("click", () => fileInputEl.click());
        attachBtnEl.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            fileInputEl.click();
          }
        });

        fileInputEl.addEventListener("change", function (e) {
          const files = Array.from(e.target.files || []);
          attachedFiles = attachedFiles.concat(files);
          // dedupe
          const seen = new Map();
          attachedFiles = attachedFiles.filter((f) => {
            const key = `${f.name}_${f.size}_${f.lastModified}`;
            if (seen.has(key)) return false;
            seen.set(key, true);
            return true;
          });
          const dt = new DataTransfer();
          attachedFiles.forEach((f) => dt.items.add(f));
          fileInputEl.files = dt.files;
          renderSelectedFiles();
        });
      }

      function sendWithAttachments() {
        const text = msgInput.value.trim();
        if (!text && attachedFiles.length === 0) return;

        const now = new Date();
        const timeString = now.toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit",
        });

        const wrapper = document.createElement("div");
        wrapper.className = "flex justify-end group animate-pulse";

        let attachmentsHtml = "";
        if (attachedFiles.length) {
          attachmentsHtml =
            `<div class=\"mt-2 space-y-2\">` +
            attachedFiles
              .map(
                (f) => `
            <div class=\"bg-white border border-slate-200 p-2 rounded-md flex items-center gap-3 max-w-xs\">\n              <svg class=\"w-5 h-5 text-slate-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656\"/></svg>\n              <div class=\"text-sm truncate\">${escapeHtml(
              f.name
            )}</div>\n            </div>
          `
              )
              .join("") +
            `</div>`;
        }

        wrapper.innerHTML = `
          <div class="max-w-md">
            <div class="wa-message-sent p-3 px-4 rounded-lg rounded-tr-none text-sm text-[#111b21]">
              <p class="leading-relaxed">${escapeHtml(text) || " "}</p>
              ${attachmentsHtml}
              <div class="text-[10px] text-slate-500 text-right mt-1 flex justify-end gap-1 items-center">
                <span>${timeString}</span>
                <svg class="w-3 h-3 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
              </div>
            </div>
          </div>
        `;

        messagesContainer.appendChild(wrapper);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;

        // clear
        msgInput.value = "";
        attachedFiles = [];
        const dtClear = new DataTransfer();
        if (fileInputEl) fileInputEl.files = dtClear.files;
        renderSelectedFiles();

        // Redirect to WhatsApp (text only)
        setTimeout(() => {
          const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(
            text
          )}`;
          window.open(url, "_blank");
          wrapper.classList.remove("animate-pulse");
        }, 500);
      }
    </script>
  </body>
</html>
